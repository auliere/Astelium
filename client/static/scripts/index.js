"use strict";function __extends(e,t){function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},AudioManager=function(){function e(e){this._audioMap=e||new Map([])}return Object.defineProperty(e.prototype,"generalVolume",{get:function(){return this._generalVolume},set:function(e){this._generalVolume=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioMap",{get:function(){return this._audioMap},set:function(e){this._audioMap=e},enumerable:!0,configurable:!0}),e.prototype.load=function(e){var t=this;e.forEach(function(e){t.audioMap.set(e,new Audio(e))})},e.prototype.play=function(e,t,n){var o=this.audioMap.get(e);o.loop=t||!1,o.volume=n||this._generalVolume||1,o.play()},e.prototype.playSelected=function(e,t,n){var o=this;this.audioMap.forEach(function(i,r){console.log(e,r),e.includes(r)?(i.loop=t||!1,i.volume=n||o._generalVolume||1,i.play()):i.pause()})},e.prototype.stopAll=function(){this.audioMap.forEach(function(e){e.played&&e.pause()})},e.prototype.stopAllExceptSelected=function(e){this.audioMap.forEach(function(t,n){e.includes(n)&&t.played&&t.pause()})},e}(),AsteliumAudioManager=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(AudioManager),GameStateManager=function(){function e(e,t){this._currentState=e||null,this._savedGames=t||[]}return Object.defineProperty(e.prototype,"currentState",{get:function(){return this.currentState},set:function(e){this._currentState=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"savedGames",{get:function(){return this._savedGames},set:function(e){this._savedGames=e},enumerable:!0,configurable:!0}),e.prototype.save=function(e,t){console.log("Save");var n={date:(new Date).toString(),state:this._currentState,name:e};console.log(n),fetch("/save",{method:"POST",body:JSON.stringify(n),headers:new Headers({"Content-Type":"application/json"})}).then(function(e){return e.json()}).then(function(e){console.log(e)})},e.prototype.load=function(e,t){console.log("Load")},e}(),AsteliumGameStateManager=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(GameStateManager),Model=function(){function e(t,n,o,i,r){this._selector=t,this._audioManager=n||new AudioManager(new Map([])),this._HTMLTemplate=o||e.EMPTY_HTML_TEMPLATE,this._stateManager=i||new GameStateManager(this._HTMLTemplate,[]),this._autoRendering=r||!1}return Object.defineProperty(e.prototype,"selector",{get:function(){return this._selector},set:function(e){this._selector=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HTMLTemplate",{get:function(){return this._HTMLTemplate},set:function(e){this._HTMLTemplate=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioManager",{get:function(){return this._audioManager},set:function(e){this._audioManager=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateManager",{get:function(){return this._stateManager},set:function(e){this._stateManager=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentModel",{get:function(){return this._parentModel},set:function(e){this._parentModel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"childModels",{get:function(){return this._childModels},set:function(e){this._childModels=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoRendering",{get:function(){return this._autoRendering},set:function(e){this._autoRendering=e},enumerable:!0,configurable:!0}),e.EMPTY_HTML_TEMPLATE="<div>Empty model</div>",e}(),Layout=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(e,t){var n=this;this.HTMLTemplate='<div id="'+this.selector+'"></div>',e&&null!=e?document.querySelector("#"+e).innerHTML=this.HTMLTemplate:document.querySelector("body").innerHTML=this.HTMLTemplate,this.childModels&&this.childModels.length>0&&this.childModels.forEach(function(e){e.parentModel=n,e.autoRendering&&e.render(n.selector)}),this.audioManager.playSelected([t])},t}(Model),Direction;!function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT"}(Direction||(Direction={}));var Mover=function(e){function t(t,n,o,i,r,a){var s=e.call(this,t,n,o,i,r)||this;return s._position=a,s}return __extends(t,e),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:!0,configurable:!0}),t.prototype.changePositionX=function(e,t){t===Direction.RIGHT?this._position.x+=e:t===Direction.LEFT&&(this._position.x-=e)},t.prototype.changePositionY=function(e,t){t===Direction.UP?this._position.y-=e:t===Direction.DOWN&&(this._position.y+=e)},t.prototype.changePosition=function(e,t,n,o){this.changePositionX(e,t),this.changePositionY(n,o)},t.prototype.moveUp=function(e){this.changePositionY(e,Direction.UP),document.querySelector("#"+this.selector).style.top=this._position.y+"px"},t.prototype.moveDown=function(e){this.changePositionY(e,Direction.DOWN),document.querySelector("#"+this.selector).style.top=this._position.y+"px"},t.prototype.moveLeft=function(e){this.changePositionX(e,Direction.LEFT),document.querySelector("#"+this.selector).style.transform="scaleX(1)",document.querySelector("#"+this.selector).style.left=this._position.x+"px"},t.prototype.moveRight=function(e){this.changePositionX(e,Direction.RIGHT),document.querySelector("#"+this.selector).style.transform="scaleX(-1)",document.querySelector("#"+this.selector).style.left=this._position.x+"px"},t.prototype.rotate=function(e){document.querySelector(""+this.selector).style.rotate=""+e},t}(Model),AsteliumPlayer=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(){this.addMoveListeners(),this.addActionListeners()},t.prototype.addMoveListeners=function(){var e=this;document.addEventListener("keypress",function(t){switch(t.key){case"w":e.moveUp(3);break;case"s":e.moveDown(3);break;case"a":e.moveLeft(3);break;case"d":e.moveRight(3)}})},t.prototype.addActionListeners=function(){var e=this;document.addEventListener("keydown",function(t){"Enter"===t.key&&console.log("Action is called"),"Escape"===t.key&&(e.audioManager.playSelected(["/soul.mp3","/menu.mp3"]),e.parentModel.renderSelectedChildren(["ast-menu"]))})},t.prototype.render=function(e){this.HTMLTemplate='<div id="'+this.selector+'"></div>',document.querySelector("#"+e).innerHTML+=this.HTMLTemplate,document.querySelector("#"+this.selector).style.top=this.position.y+"px",document.querySelector("#"+this.selector).style.left=this.position.x+"px",this.init()},t}(Mover),Advicer=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(){},t.prototype.render=function(e){this.HTMLTemplate='<div id="'+this.selector+'"></div>',document.querySelector("#"+e).innerHTML+=this.HTMLTemplate,document.querySelector("#"+this.selector).style.top=this.position.y+"px",document.querySelector("#"+this.selector).style.left=this.position.x+"px"},t}(Mover),Menu=function(e){function t(t,n,o,i,r,a){var s=e.call(this,t,n,o,i,r)||this;return s._actionItems=a||new Map([["Item 1",function(){console.log("Item 1 was chosen")}],["Item 2",function(){console.log("Item 2 was chosen")}],["Item 3",function(){console.log("Item 3 was chosen")}]]),s}return __extends(t,e),Object.defineProperty(t.prototype,"actionItems",{get:function(){return this._actionItems},set:function(e){this._actionItems=e},enumerable:!0,configurable:!0}),t}(Model),AsteliumMenu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(e){this.audioManager.play("/menu.mp3",!0),this.HTMLTemplate===Model.EMPTY_HTML_TEMPLATE?this.initializeView(this.getBasicItems()):this.initializeView(this.actionItems),this.registerEvents()},t.prototype.getBasicItems=function(){var e=this;return new Map([["New game",function(){e.initializeView(e.getNewGameItems()),e.registerEvents(),e.audioManager.play("/newgame.mp3")}],["Load",function(){e.initializeView(e.getSavedGamesItems()),e.registerEvents()}],["Options",function(){e.audioManager.play("/options.mp3")}]])},t.prototype.getNewGameItems=function(){var e=this;return new Map([["SinglePlayer",function(){e.initializeView(e.getInGameItems()),e.registerEvents(),e.audioManager.playSelected(["/singleplayer.mp3","/location.mp3"]),e.parentModel.renderSelectedChildren(["ast-player","ast-advicer"])}],["Multiplayer",function(){e.audioManager.play("/multiplayer.mp3")}],["Back",function(){e.initializeView(e.getBasicItems()),e.registerEvents()}]])},t.prototype.getInGameItems=function(){var e=this;return new Map([["Save",function(){e.parentModel.stateManager.save((new Date).toString(),"/save")}],["Load",function(){e.parentModel.stateManager.load((new Date).toString(),"/load")}],["Continue",function(){e.audioManager.playSelected(["/location.mp3"]),e.parentModel.renderSelectedChildren(["ast-player","ast-advicer"])}]])},t.prototype.getSavedGamesItems=function(){var e=this,t=this.parentModel.stateManager,n=new Map;return t.savedGames.forEach(function(e){n.set(e.name+" ---- "+e.date,function(){t.load(e.name,"/load")})}),n.set("Back",function(){e.initializeView(e.actionItems),e.registerEvents()}),n},t.prototype.hideView=function(){this.audioManager.playSelected(["/singleplayer.mp3","/location.mp3"]),this.parentModel.renderSelectedChildren(["ast-player","ast-advicer"]),this.initializeView(this.getInGameItems()),this.registerEvents()},t.prototype.initializeView=function(e){var t='<div id="${this.selector}"><div class="ast-header">ASTELIUM</div><div class="ast-logo"></div>';this.actionItems=e,this.actionItems.forEach(function(e,n){var o='<div class="action-item" id="action-'+n.substring(0,3)+'">\n                <button>'+n+"</button>\n            </div>";t+=o}),t+="</div>",this.HTMLTemplate=t,document.querySelector("#"+this.parentModel.selector).innerHTML=this.HTMLTemplate},t.prototype.registerEvents=function(){this.actionItems.forEach(function(e,t){document.querySelector("#action-"+t.substring(0,3)).addEventListener("click",e)})},t}(Menu),AsteliumGameLayout=function(e){function t(t,n,o,i,r){var a=e.call(this,t,n)||this;return a.childModels=[new AsteliumMenu("ast-menu",n,null,i,!0),new AsteliumPlayer("ast-player",n,null,i,!1,{x:0,y:0}),new Advicer("ast-advicer",n,null,i,!1,{x:250,y:250})],a}return __extends(t,e),t.prototype.renderChild=function(e){this.childModels.find(function(t){return t.selector===e}).render(this.selector)},t.prototype.renderSelectedChildren=function(e){var t=this;document.querySelector("#"+this.selector).innerHTML="",e.forEach(function(e){return t.renderChild(e)})},t}(Layout);document.addEventListener("DOMContentLoaded",function(){console.log("Document was loaded");var e=new AsteliumAudioManager,t=new AsteliumGameStateManager;e.load(["/location.mp3","/menu.mp3","/multiplayer.mp3","/newgame.mp3","/options.mp3","/singleplayer.mp3","/slime.mp3","/soul.mp3"]),new AsteliumGameLayout("game-layout",e,null,t,!0).render("renderTarget","/menu.mp3")});
