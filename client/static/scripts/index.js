"use strict";function __extends(e,t){function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},AudioManager=function(){function e(e){this._audioMap=e||new Map([])}return Object.defineProperty(e.prototype,"generalVolume",{get:function(){return this._generalVolume},set:function(e){this._generalVolume=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioMap",{get:function(){return this._audioMap},set:function(e){this._audioMap=e},enumerable:!0,configurable:!0}),e.prototype.load=function(e){var t=this;e.forEach(function(e){t.audioMap.set(e,new Audio(e))})},e.prototype.play=function(e,t,n){var o=this.audioMap.get(e);o.loop=t||!1,o.volume=n||this._generalVolume||1,o.play()},e.prototype.playSelected=function(e,t,n){var o=this;this.audioMap.forEach(function(i,r){console.log(e,r),e.includes(r)?(i.loop=t||!1,i.volume=n||o._generalVolume||1,i.play()):i.pause()})},e.prototype.stopAll=function(){this.audioMap.forEach(function(e){e.played&&e.pause()})},e.prototype.stopAllExceptSelected=function(e){this.audioMap.forEach(function(t,n){e.includes(n)&&t.played&&t.pause()})},e}(),Model=function(){function e(t,n,o,i){this._selector=t,this._audioManager=n||new AudioManager(new Map([])),this._HTMLTemplate=o||e.EMPTY_HTML_TEMPLATE,this._autoRendering=i||!1}return Object.defineProperty(e.prototype,"selector",{get:function(){return this._selector},set:function(e){this._selector=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HTMLTemplate",{get:function(){return this._HTMLTemplate},set:function(e){this._HTMLTemplate=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioManager",{get:function(){return this._audioManager},set:function(e){this._audioManager=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentSelector",{get:function(){return this._parentSelector},set:function(e){this._parentSelector=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"childModels",{get:function(){return this._childModels},set:function(e){this._childModels=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoRendering",{get:function(){return this._autoRendering},set:function(e){this._autoRendering=e},enumerable:!0,configurable:!0}),e.EMPTY_HTML_TEMPLATE="<div>Empty model</div>",e}(),Menu=function(e){function t(t,n,o,i,r){var a=e.call(this,t,n,o,i)||this;return a._actionItems=r||new Map([["Item 1",function(){console.log("Item 1 was chosen")}],["Item 2",function(){console.log("Item 2 was chosen")}],["Item 3",function(){console.log("Item 3 was chosen")}]]),a}return __extends(t,e),Object.defineProperty(t.prototype,"actionItems",{get:function(){return this._actionItems},set:function(e){this._actionItems=e},enumerable:!0,configurable:!0}),t}(Model),Engine=function(){function e(e){this._modelsMap=e||new Map}return Object.defineProperty(e.prototype,"modelsMap",{get:function(){return this._modelsMap},set:function(e){this._modelsMap=e},enumerable:!0,configurable:!0}),e.prototype.getModel=function(e){return this._modelsMap.get(e)},e.prototype.loadModels=function(e){var t=this;e.forEach(function(e){t._modelsMap.set(e.selector,e)})},e}(),APP_ENGINE_INSTANCE=new Engine,AsteliumMenu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(e){this.audioManager.play("/menu.mp3",!0),this.HTMLTemplate===Model.EMPTY_HTML_TEMPLATE?this.initializeView(this.getBasicItems()):this.initializeView(this.actionItems),this.registerEvents()},t.prototype.getBasicItems=function(){var e=this;return new Map([["New game",function(){e.initializeView(e.getNewGameItems()),e.registerEvents(),e.audioManager.play("/newgame.mp3")}],["Load",function(){e.initializeView(e.getSavedGamesItems()),e.registerEvents()}],["Options",function(){e.audioManager.play("/options.mp3")}]])},t.prototype.getNewGameItems=function(){var e=this;return new Map([["SinglePlayer",function(){var t=APP_ENGINE_INSTANCE.getModel(e.parentSelector);e.initializeView(e.getInGameItems()),e.registerEvents(),e.audioManager.playSelected(["/singleplayer.mp3","/location.mp3"]),t.renderSelectedChildren(["ast-player","ast-advicer"])}],["Multiplayer",function(){e.audioManager.play("/multiplayer.mp3")}],["Back",function(){e.initializeView(e.getBasicItems()),e.registerEvents()}]])},t.prototype.getInGameItems=function(){var e=this,t=APP_ENGINE_INSTANCE.getModel(this.parentSelector);return new Map([["Save",function(){t.stateManager.save((new Date).toLocaleTimeString("en-us",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(/\:/g,"-"),"/save"),e.audioManager.playSelected(["/location.mp3"]),t.renderSelectedChildren(["ast-player","ast-advicer"])}],["Load",function(){e.initializeView(e.getSavedGamesItems()),e.registerEvents()}],["Continue",function(){e.audioManager.playSelected(["/location.mp3"]),t.renderSelectedChildren(["ast-player","ast-advicer"])}]])},t.prototype.getSavedGamesItems=function(){var e=this,t=APP_ENGINE_INSTANCE.getModel(this.parentSelector),n=t.stateManager,o=new Map;return n.savedGames.forEach(function(e,t){o.set(t+1+"-"+e.name,function(){n.load(e.name,"/load")})}),o.set("Back",function(){e.initializeView(e.getInGameItems()),e.audioManager.playSelected(["/location.mp3"]),t.renderSelectedChildren(["ast-player","ast-advicer"])}),console.log("SavedGames",o),o},t.prototype.hideView=function(){var e=APP_ENGINE_INSTANCE.getModel(this.parentSelector);this.audioManager.playSelected(["/singleplayer.mp3","/location.mp3"]),e.renderSelectedChildren(["ast-player","ast-advicer"]),this.initializeView(this.getInGameItems()),this.registerEvents()},t.prototype.initializeView=function(e){var t=APP_ENGINE_INSTANCE.getModel(this.parentSelector),n='<div id="'+this.selector+'">\n            <div class="ast-header">ASTELIUM</div>\n            <div class="ast-logo">\n        </div>';this.actionItems=e,this.actionItems.forEach(function(e,t){var o='<div class="action-item" id="action-'+t.substring(0,3)+'">\n                <button>'+t+"</button>\n            </div>";n+=o}),n+="</div>",this.HTMLTemplate=n,document.querySelector("#"+t.selector).innerHTML=this.HTMLTemplate},t.prototype.registerEvents=function(){this.actionItems.forEach(function(e,t){document.querySelector("#action-"+t.substring(0,3)).addEventListener("click",e)})},t}(Menu),AsteliumAudioManager=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(AudioManager),GameStateManager=function(){function e(e,t){this._currentState=e||null,this._savedGames=t||[]}return Object.defineProperty(e.prototype,"currentState",{get:function(){return this.currentState},set:function(e){this._currentState=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"savedGames",{get:function(){return this._savedGames},set:function(e){this._savedGames=e},enumerable:!0,configurable:!0}),e.prototype.save=function(e,t){var n={date:(new Date).toLocaleTimeString("en-us",{weekday:"long",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}),state:this._currentState,name:e};console.log("Save",n),fetch("/save",{method:"POST",body:JSON.stringify(n),headers:new Headers({"Content-Type":"application/json"})}).then(function(e){return e.json()}),this._savedGames.push(n)},e.prototype.load=function(e,t){console.log("Loading is in progress...")},e}(),AsteliumGameStateManager=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(GameStateManager),Layout=function(e){function t(t,n,o,i,r){var a=e.call(this,t,n,o,i)||this;return a._stateManager=r,a}return __extends(t,e),Object.defineProperty(t.prototype,"stateManager",{get:function(){return this._stateManager},set:function(e){this._stateManager=e},enumerable:!0,configurable:!0}),t}(Model),AsteliumGameLayout=function(e){function t(t,n,o,i,r){return e.call(this,t,n,o,i,r)||this}return __extends(t,e),t.prototype.renderChild=function(e){this.childModels.find(function(t){return t.selector===e}).render(this.selector)},t.prototype.renderSelectedChildren=function(e){var t=this;document.querySelector("#"+this.selector).innerHTML="",e.forEach(function(e){return t.renderChild(e)})},t.prototype.render=function(e,t){var n=this;this.HTMLTemplate='<div id="'+this.selector+'"></div>',e&&null!=e?document.querySelector("#"+e).innerHTML=this.HTMLTemplate:document.querySelector("body").innerHTML=this.HTMLTemplate,this.childModels&&this.childModels.length>0&&this.childModels.forEach(function(e){e.parentSelector=n.selector,e.autoRendering&&e.render(n.selector)}),this.audioManager.playSelected([t])},t}(Layout),GameObject=function(e){function t(t,n,o,i,r){var a=e.call(this,t,n,o,i)||this;return a._position=r,a}return __extends(t,e),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:!0,configurable:!0}),t}(Model),Direction;!function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT"}(Direction||(Direction={}));var Mover=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.changePositionX=function(e,t){t===Direction.RIGHT?this.position.x+=e:t===Direction.LEFT&&(this.position.x-=e)},t.prototype.changePositionY=function(e,t){t===Direction.UP?this.position.y-=e:t===Direction.DOWN&&(this.position.y+=e)},t.prototype.changePosition=function(e,t,n,o){this.changePositionX(e,t),this.changePositionY(n,o)},t.prototype.moveUp=function(e){this.changePositionY(e,Direction.UP),document.querySelector("#"+this.selector).style.top=this.position.y+"px"},t.prototype.moveDown=function(e){this.changePositionY(e,Direction.DOWN),document.querySelector("#"+this.selector).style.top=this.position.y+"px"},t.prototype.moveLeft=function(e){this.changePositionX(e,Direction.LEFT),document.querySelector("#"+this.selector).style.transform="scaleX(1)",document.querySelector("#"+this.selector).style.left=this.position.x+"px"},t.prototype.moveRight=function(e){this.changePositionX(e,Direction.RIGHT),document.querySelector("#"+this.selector).style.transform="scaleX(-1)",document.querySelector("#"+this.selector).style.left=this.position.x+"px"},t.prototype.rotate=function(e){document.querySelector(""+this.selector).style.rotate=""+e},t}(GameObject),AsteliumPlayer=function(e){function t(t,n,o,i,r){var a=e.call(this,t,n,o,i,r)||this;return a.init(),a}return __extends(t,e),t.prototype.init=function(){this.addMoveListeners(),this.addActionListeners()},t.prototype.addMoveListeners=function(){var e=this;document.addEventListener("keypress",function(t){switch(t.key){case"w":e.moveUp(3);break;case"s":e.moveDown(3);break;case"a":e.moveLeft(3);break;case"d":e.moveRight(3)}})},t.prototype.addActionListeners=function(){var e=this;document.addEventListener("keydown",function(t){var n=APP_ENGINE_INSTANCE.getModel(e.parentSelector);"Enter"===t.key&&console.log("Action is called"),"Escape"===t.key&&(n.stateManager.currentState={gameObjects:n.childModels.filter(function(e){return e instanceof GameObject}),dom:document.querySelector("#"+n.selector).outerHTML},e.audioManager.playSelected(["/soul.mp3","/menu.mp3"]),n.renderSelectedChildren(["ast-menu"]))})},t.prototype.render=function(e){this.HTMLTemplate='<div id="'+this.selector+'"></div>',document.querySelector("#"+e).innerHTML+=this.HTMLTemplate,document.querySelector("#"+this.selector).style.top=this.position.y+"px",document.querySelector("#"+this.selector).style.left=this.position.x+"px"},t}(Mover),Advicer=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(){},t.prototype.render=function(e){this.HTMLTemplate='<div id="'+this.selector+'"></div>',document.querySelector("#"+e).innerHTML+=this.HTMLTemplate,document.querySelector("#"+this.selector).style.top=this.position.y+"px",document.querySelector("#"+this.selector).style.left=this.position.x+"px"},t}(Mover);document.addEventListener("DOMContentLoaded",function(){console.log("Document was loaded");var e=new AsteliumAudioManager,t=new AsteliumGameStateManager;e.load(["/location.mp3","/menu.mp3","/multiplayer.mp3","/newgame.mp3","/options.mp3","/singleplayer.mp3","/slime.mp3","/soul.mp3"]),APP_ENGINE_INSTANCE.loadModels([new AsteliumGameLayout("game-layout",e,null,!0,t),new AsteliumMenu("ast-menu",e,null,!0),new AsteliumPlayer("ast-player",e,null,!1,{x:0,y:0}),new Advicer("ast-advicer",e,null,!1,{x:250,y:250})]);var n=APP_ENGINE_INSTANCE.getModel("game-layout");n.childModels=[APP_ENGINE_INSTANCE.getModel("ast-menu"),APP_ENGINE_INSTANCE.getModel("ast-player"),APP_ENGINE_INSTANCE.getModel("ast-advicer")],n.render("renderTarget","/menu.mp3")});
